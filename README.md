# Движок для новогодней олимпиады ЛКШ 2022.Зима
В ЛКШ 2022.Зима новогодняя олимпиада по программированию была проведена в необычном формате. Команды из 5-6 человек получали доступ к полю из задач-шестиугольников:

Решив задачу, участники получают возможность прочитать условия задач вокруг решённой.

За неправильные попытки начисляется штраф. Штраф не может превышать 70% исходной стоимости задачи (но это настраивается).

# Где что лежит
В папке `src` — обычное джанго-приложение. Настройки лежат в `src/olymp/settings.py`. Важные настройки — в конце этого файла. 
Там можно указать путь до `serve.cfg` из ejudge, токен для телеграм-бота и идентификатор телеграм-чата. В этот чат будут приходит оповещения о том, что кто-то взял бонус.

Запускать на сервере любым доступным и привычным для джанго-приложений способом. Например, в связке с `nginx` и `uwsgi`.

# Развёртывание
1. Необходимо распаковать polygon-архив контеста в `init/polygon-contest`
2. Добавить в `init/files-russian` все условия задач, назвав их в соответствии
   с названием задачи в polygon. Есть два способа это сделать:
   * Вручную, собрав pdf с условиями в polygon и просто сложив их в папку с нужными именами.
   * Запустив скрипт `./init/build_statements.py`. До запуска желательно обновить метаинформацию о контесте
     в `./init/template.tex`. Для запуска скрипта необходимо
     иметь установленный `pdflatex` с некоторым множеством установленных пакетов, достаточное множество
     которых можно подсмотреть во `flake.nix`.
3. Заменить `serve.cfg` на конфиг контеста из ejudge
4. Изменить в `src/olymp/settings.py` адрес до базы данных ejudge и id контеста.
6. Задать конфигурацию поля в `init/init.txt`. Для осознания формата можно почитать `init.py`,
   генерирующий по данному файлу django объекты. После завершения описания, запустить `./init/init.py`.
7. Собрать докер контейнер через `docker build ./`
8. Доставить контейнер на хост любым удобным способом. Порт приложения: 5555.
   Обратите внимание, что данный хост должен быть способен подключиться к БД ejudge.

**Предупреждение: сервер внутри docker крутиться в debug mode, при ошибке пользователь увидит все "кишки" сайта**

## Учётные данные
Логин\Пароль от аккаунта суперпользователя в django: admin\sn0wball. Зайти
в админовскую панель можно по адресу <app-site>/admin.

Для участников логин-пароль для входа совпадает с учётными данными ejudge, из
под которого они пишут контест. Никакой дополнительной регистрации не требуется.
